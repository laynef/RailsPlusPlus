module Response
  def render_json data, status
    data = JSON.parse(data) if data.is_a?(String)
    data[:data] = data[:data].map {|e| object_delete(e) } if data && data[:data] && !data[:data].empty?
    data = object_delete(data) if data && !data[:data]
    render json: data, status: status
  end

  private

  def black_list
    [
      :password_digest
    ]
  end

  def object_delete(hash)
    json = JSON.parse(hash.to_json).symbolize_keys
    black_list.each do |e|
      if json[e].is_a?(Hash)
        json[e] = object_delete(json[e])
      elsif json[e].is_a?(Array)
        json[e] = json[e].map {|i| object_delete(i) }
      elsif json[e]
        json.delete(e)
      end
    end
    json
  end
end
